<div class="profile-container">
  <div class="profile-header">
    <h1>My Profile</h1>
    <p>Manage your account information</p>
  </div>

  @if (successMessage()) {
    <div class="alert alert-success">
      <span class="icon">✓</span>
      {{ successMessage() }}
    </div>
  }

  @if (errorMessage()) {
    <div class="alert alert-error">
      <span class="icon">⚠</span>
      {{ errorMessage() }}
    </div>
  }

  <div class="profile-content">
    <div class="profile-card avatar-section">
      <div class="avatar-container">
        @if (user()) {
          <img [src]="user()!.avatar" [alt]="user()!.firstName" class="avatar-large">
        }
        <button class="btn-avatar-change">Change Avatar</button>
      </div>
    </div>

    <div class="profile-card">
      <div class="card-header">
        <h2>Personal Information</h2>
        @if (!isEditing()) {
          <button class="btn btn-primary" (click)="toggleEdit()">
            Edit Profile
          </button>
        }
      </div>

      <div class="card-body">
        <div class="form-group">
          <label>First Name</label>
          @if (isEditing()) {
            <input 
              type="text" 
              [value]="firstName()"
              (input)="firstName.set($any($event.target).value)"
              class="form-control"
            >
          } @else {
            <div class="form-value">{{ firstName() }}</div>
          }
        </div>

        <div class="form-group">
          <label>Last Name</label>
          @if (isEditing()) {
            <input 
              type="text" 
              [value]="lastName()"
              (input)="lastName.set($any($event.target).value)"
              class="form-control"
            >
          } @else {
            <div class="form-value">{{ lastName() }}</div>
          }
        </div>

        <div class="form-group">
          <label>Email Address</label>
          @if (isEditing()) {
            <input 
              type="email" 
              [value]="email()"
              (input)="email.set($any($event.target).value)"
              class="form-control"
            >
          } @else {
            <div class="form-value">{{ email() }}</div>
          }
        </div>

        <div class="form-group">
          <label>Username</label>
          @if (isEditing()) {
            <input 
              type="text" 
              [value]="username()"
              (input)="username.set($any($event.target).value)"
              class="form-control"
            >
          } @else {
            <div class="form-value">{{ username() }}</div>
          }
        </div>

        @if (isEditing()) {
          <div class="form-actions">
            <button 
              class="btn btn-secondary" 
              (click)="cancelEdit()"
              [disabled]="loading()"
            >
              Cancel
            </button>
            <button 
              class="btn btn-primary" 
              (click)="saveProfile()"
              [disabled]="loading()"
            >
              @if (loading()) {
                <span class="spinner"></span>
                Saving...
              } @else {
                Save Changes
              }
            </button>
          </div>
        }
      </div>
    </div>

    <div class="profile-card">
      <div class="card-header">
        <h2>Preferences</h2>
      </div>

      <div class="card-body">
        @if (user()?.preferences) {
          <div class="preference-item">
            <span class="preference-label">Currency</span>
            <span class="preference-value">{{ user()!.preferences?.currency }}</span>
          </div>

          <div class="preference-item">
            <span class="preference-label">Language</span>
            <span class="preference-value">{{ user()!.preferences?.language }}</span>
          </div>

          <div class="preference-item">
            <span class="preference-label">Theme</span>
            <span class="preference-value">{{ user()!.preferences?.theme }}</span>
          </div>

          <div class="preference-item">
            <span class="preference-label">Notifications</span>
            <span class="preference-value">
              {{ user()!.preferences?.notifications ? 'Enabled' : 'Disabled' }}
            </span>
          </div>

          <div class="preference-item">
            <span class="preference-label">Email Notifications</span>
            <span class="preference-value">
              {{ user()!.preferences?.emailNotifications ? 'Enabled' : 'Disabled' }}
            </span>
          </div>
        }
      </div>
    </div>

    <div class="profile-card">
      <div class="card-header">
        <h2>Security</h2>
        @if (!showPasswordForm()) {
          <button class="btn btn-secondary" (click)="togglePasswordForm()">
            Change Password
          </button>
        }
      </div>

      @if (showPasswordForm()) {
        <div class="card-body">
          <div class="form-group">
            <label>Current Password</label>
            <input 
              type="password" 
              [value]="currentPassword()"
              (input)="currentPassword.set($any($event.target).value)"
              class="form-control"
              placeholder="Enter current password"
            >
          </div>

          <div class="form-group">
            <label>New Password</label>
            <input 
              type="password" 
              [value]="newPassword()"
              (input)="newPassword.set($any($event.target).value)"
              class="form-control"
              placeholder="Enter new password"
            >
          </div>

          <div class="form-group">
            <label>Confirm New Password</label>
            <input 
              type="password" 
              [value]="confirmPassword()"
              (input)="confirmPassword.set($any($event.target).value)"
              class="form-control"
              placeholder="Confirm new password"
            >
          </div>

          <div class="form-actions">
            <button 
              class="btn btn-secondary" 
              (click)="togglePasswordForm()"
              [disabled]="loading()"
            >
              Cancel
            </button>
            <button 
              class="btn btn-primary" 
              (click)="changePassword()"
              [disabled]="loading()"
            >
              @if (loading()) {
                <span class="spinner"></span>
                Changing...
              } @else {
                Change Password
              }
            </button>
          </div>
        </div>
      } @else {
        <div class="card-body">
          <div class="preference-item">
            <span class="preference-label">Password</span>
            <span class="preference-value">••••••••</span>
          </div>
          <div class="preference-item">
            <span class="preference-label">Account Created</span>
            <span class="preference-value">
              @if (user()) {
                {{ user()!.createdAt | date:'medium' }}
              }
            </span>
          </div>
        </div>
      }
    </div>
  </div>
</div>
